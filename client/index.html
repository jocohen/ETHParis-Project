<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Ethereum connexion</title>
	<script language="javascript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script language="javascript" type="text/javascript" src="web3.min.js"></script>
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
	<script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
	<script language="javascript" type="text/javascript" src="js/trackAbi.js"></script>
</head>
<body>
	hello
	<div id="orders"></div>

	<script>
	var track;
	var userAccount;

	function startApp() {
		var trackAddress = "0xC577d4166Cd173CF059b92882929560c2f03B222";
		track = new web3js.eth.Contract(trackAbi, trackAddress);
	}

	var accountInterval = setInterval(function() {
		// Check if account has changed
		if (web3.eth.accounts[0] !== userAccount) {
			userAccount = web3.eth.accounts[0];
			// Call a function to update the UI with the new account
			console.log(userAccount)
		}
	}, 100);


	function displayOrders(ids) {
		$("#orders").empty();
		for (id of ids) {
			getOrderDetails(id)
			.then(function(orders) {
				$("#orders").append(`<div class="order">
				<ul>
				<li>provider: ${orders.provier}</li>
				<li>transporter: ${orders.transporter}</li>
				<li>client: ${orders.client}</li>
				<li>state: ${orders.state}</li>
				</ul>
				</div>`);
			});
		}
	}

	function getOrderDetails(id) {
		console.log(track);
		return track.methods.getOrderDetail(id).call()

	// Appelle la fonction et fait quelque chose avec le r√©sultat :
	getOrderDetails(1).then(function(result){
	console.log("Order 1: " + JSON.stringify(result));
	});
	}

	window.addEventListener('load', function() {


		if (web3.eth.accounts[0] !== userAccount) {
			userAccount = web3.eth.accounts[0];

			if (typeof web3 !== 'undefined') {
				web3js = new Web3(web3.currentProvider);
			} else {
				toastr.warning('Please install metamask', 'Metamask!');
			}

			startApp()
		}
	})

	</script>

</body>
</html>
